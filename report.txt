---
- name: Progress report by Mugadzhir
  hosts:
  beecome: yes

  tasks:
  - name: The difficulties I faced
    disc: Ошибок было много, но почти все сразу гуглилось. Работа с qemu не
          вызвала много проблем, как впрочем и все первое задание, за
          исключением одного момента. Поначалу я пытался создать виртуалку
          через virt-install, но я накосячил с созданием пулов, изменил тип
          файловой системы и крашнул Ubuntu(256G мало для двух систем). Пришлось
          переустанавливать систему, тк ничего не смог с этим поделать. После этого
          я просто создал образ через qemu-img и проэмулировал работу моей системы.
          Для виртуалки я использую серверную версию Ubuntu, поэтому не
          пришлось подключать уши и графику. Сеть указал default, и уже в 
          виртуалке в virsh через net-edit изменил ip виртуалки. Ping
          выполнился. Далее пощупал virt manager, все понятно, однако кроме
          создания и запуска виртуалки ничего не сделал, всякие там
          snapshot'ы. И что странно(а может и нет) ip у виртуалки уже
          отличался от хостовской и выполнялся пинг, хотя создавал виртуалку
          в той же сети.
          С ансиблом поначалу серьезных проблем тоже не было, чисто бытовые.
          По указанию Валерии и гуглу сгенерил ключ, и закинул его в
          authorized_keys. Далее проверил подключение по ssh и записал
          виртуалку в hosts. Проверил подключение через модуль ping.
          Файл создал с помощью модуля file, но только пустой, для 
          заполнения нужно вроде писать шаблоны, это еще не смотрел.
          С помошью copy смог создать непустой файл и передать информацию
          в виде строки как параметр content.


          В институтском облаке создал виртуальную машину, с этим проблем
          не возникло. Для облачных модулей установил Openstacksdk,
          python3-openstackclient в виртуальном окружении. Далее немного
          тупил пока Валерия не показала как вытащить rc-файл. Записал файл
          clouds.yaml, написал playbook и опять начал тупить пока не узнал
          про localhost. Пытался вытащить инфу о серверах через
          os_server_info и... все также тупил пока Валерия не спросила
          версию ансибла. Далее все прошло идеально. Но вдруг ансибл решил
          поменять путь к модулям, возможно это произошло после клонирования
          гитовской директории. Поэтому при создании своего модуля он читал    
          код из старой директории. Поменяв путь к модулям все решилось.
  
  -name: staff I used
   disk: 
   - qemu-img create -f qcow2 ubuntu.img 8G - создание образа
   - qemu-system-x86_64 -hda ubuntu.img -boot d -cdrom ~/downloads/ubuntu-18.04-server-amd64.iso -m 1024 - загрузка с диска
   - qemu -hda ubuntu.img -m 1024 - запуск
   - net-edit default - изменяю ip
   - ping 192.168.122.13 - выполнил пинг   
   - ssh-keygen - генерация ключа
   - cat ~/.ssh/id_rsa.pub | ssh muga@192.168.122.13 'cat >> ~/.ssh/authorized_keys' - переброска публичного ключа
   - ssh muga@192.168.122.13 - проверили подключение по ssh
   - ansible -m ping all - проверил на подключение все сервера)))
   - ansible-playbook playbook.yml - запуск модулей через плейбук


   - ssh-keygen -t rsa -f cloud.key - генерация ключей для облака
   - ssh -i cloud.key ubuntu@83.149.198.186 - подключение к облачному серваку
   - which ansible - показывает какой исполняемый файл будет запускаться с плейбуков
   - echo $PATH - указывает путь на исполняемый каталог
   - export $PATH - замещает путь указаным 
   - cd /usr/lib/python3/dist-packages/ansible/modules/cloud/openstack - перешел в корректную директорию
   - source venv/bin/activate - активация виртуального окружения
   - . hacking/env-setup - подлючает привилегии разработчика
   - далее запись кода модуля, проверка через python -m и тд. Здесь только основные команды и наиболее "экзотичные",
     которые помогли решить проблемы 

  
